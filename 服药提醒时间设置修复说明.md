# æœè¯æé†’æ—¶é—´è®¾ç½®é—®é¢˜ä¿®å¤è¯´æ˜

## ğŸ”´ é—®é¢˜æè¿°
ç”¨æˆ·è®¾ç½®æœè¯æé†’æ—¶ï¼Œæ— è®ºé€‰æ‹©ä»€ä¹ˆæ—¶é—´ï¼Œæœ€ç»ˆéƒ½åªèƒ½ä¿å­˜ä¸º 08:00

## ğŸ” æ ¹æœ¬åŸå› 

### æ•°æ®ä¼ é€’ä¸åŒ¹é…
**å‰ç«¯å‘é€æ•°æ®ï¼š**
```javascript
{
    times: ["09:00", "14:00", "20:00"],  // å‘é€çš„æ˜¯æ•°ç»„
    reminder_type: "daily",
    // ...
}
```

**åç«¯æ¥æ”¶ä»£ç ï¼ˆæ—§ï¼‰ï¼š**
```python
'time': reminder_data.get('time', '08:00'),  # âŒ åªå–å•ä¸ªå€¼ï¼Œä¸æ˜¯æ•°ç»„
```

### é—®é¢˜é“¾è·¯
```
ç”¨æˆ·è®¾ç½®æ—¶é—´ â†’ å‰ç«¯æ”¶é›†timesæ•°ç»„ â†’ åç«¯åªè¯»å–'time'å­—æ®µ â†’ é»˜è®¤å€¼'08:00'è¢«ä½¿ç”¨
```

### è¡¨å•é‡ç½®é—®é¢˜ï¼ˆæ¬¡è¦åŸå› ï¼‰
æ‰“å¼€æé†’è¡¨å•æ—¶ï¼Œæ²¡æœ‰å®Œå…¨æ¸…é™¤ä¹‹å‰çš„æ—¶é—´è¾“å…¥æ¡†ï¼Œå¯èƒ½å¯¼è‡´æ··ä¹±

## âœ… ä¿®å¤æ–¹æ¡ˆ

### 1. åç«¯ä¿®æ”¹ - medication_management.py

**ä¿®æ”¹ `add_reminder()` å‡½æ•°ï¼š**

```python
# æ”¯æŒæ–°çš„timesæ•°ç»„æ ¼å¼ï¼Œå…¼å®¹æ—§çš„timeå­—æ®µ
times = reminder_data.get('times')
if not times:
    # å…¼å®¹æ—§æ ¼å¼ï¼šå¦‚æœæ²¡æœ‰timesï¼Œä»timeè·å–
    time_val = reminder_data.get('time', '08:00')
    times = [time_val] if time_val else ['08:00']

reminder = {
    'id': reminder_id,
    'medication_id': reminder_data.get('medication_id', ''),
    'medication_name': reminder_data.get('medication_name', ''),
    'times': times,  # âœ… ä½¿ç”¨timesæ•°ç»„è€Œä¸æ˜¯time
    'reminder_type': reminder_data.get('reminder_type', 'daily'),
    'interval_days': reminder_data.get('interval_days'),
    'custom_schedule': reminder_data.get('custom_schedule'),
    'enabled': reminder_data.get('enabled', True),
    'record_id': reminder_data.get('record_id', ''),
    'created_at': datetime.now().isoformat(),
    'last_reminded': None
}
```

**å…³é”®æ”¹åŠ¨ï¼š**
- âœ… æ”¹ä¸ºè·å– `times` æ•°ç»„è€Œä¸æ˜¯å•ä¸ª `time`
- âœ… ä¿å­˜å®Œæ•´çš„ `reminder_type`, `interval_days`, `custom_schedule`
- âœ… å‘åå…¼å®¹æ—§çš„ `time` å­—æ®µ

### 2. å‰ç«¯ä¿®æ”¹ - medication.js

#### ä¿®æ”¹ 1ï¼š`showAddReminderModal()` å‡½æ•°

```javascript
function showAddReminderModal() {
    // ç¡®ä¿å·²é€‰æ‹©æ¡£æ¡ˆ
    if (!currentRecordFilter) {
        showError('è¯·å…ˆé€‰æ‹©å¥åº·æ¡£æ¡ˆï¼Œç„¶åå†æ·»åŠ æé†’');
        return;
    }
    
    // å…ˆåŠ è½½ç”¨è¯åˆ—è¡¨åˆ°é€‰æ‹©å™¨
    updateMedicationSelectors();
    
    // é‡ç½®æé†’è¡¨å•
    document.getElementById('add-reminder-form').reset();
    
    // âœ… é‡è¦ï¼šæ¸…é™¤times-containerä¸­çš„æ‰€æœ‰æ—§è¾“å…¥ï¼Œé‡æ–°åˆå§‹åŒ–
    const timesContainer = document.getElementById('times-container');
    if (timesContainer) {
        // æ¸…ç©ºæ‰€æœ‰å­å…ƒç´ 
        timesContainer.innerHTML = '';
        // é‡æ–°æ·»åŠ ç¬¬ä¸€ä¸ªæ—¶é—´è¾“å…¥æ¡†
        const firstTimeInput = document.createElement('div');
        firstTimeInput.style.display = 'flex';
        firstTimeInput.style.gap = '10px';
        firstTimeInput.style.marginBottom = '10px';
        firstTimeInput.innerHTML = `
            <input type="time" class="form-input time-input" value="08:00" required>
        `;
        timesContainer.appendChild(firstTimeInput);
    }
    
    // é‡ç½®æé†’ç±»å‹
    document.getElementById('reminder-type-select').value = 'daily';
    updateReminderFields();
    
    document.getElementById('add-reminder-modal').classList.add('active');
}
```

#### ä¿®æ”¹ 2ï¼š`addTimeInput()` å‡½æ•°

```javascript
function addTimeInput() {
    const container = document.getElementById('times-container');
    const newDiv = document.createElement('div');
    newDiv.style.display = 'flex';
    newDiv.style.gap = '10px';
    newDiv.style.marginBottom = '10px';
    newDiv.innerHTML = `
        <input type="time" class="form-input time-input" required>
        <button type="button" class="btn btn-small btn-danger" onclick="removeTimeInput(this)">åˆ é™¤</button>
    `;
    container.appendChild(newDiv);
}
```

**å…³é”®æ”¹åŠ¨ï¼š**
- âœ… å®Œå…¨æ¸…ç©ºå¹¶é‡æ–°åˆå§‹åŒ– `times-container`
- âœ… ç§»é™¤é»˜è®¤çš„ `value="12:00"`ï¼Œè®©ç”¨æˆ·è‡ªå·±è®¾ç½®

## ğŸ§ª æµ‹è¯•éªŒè¯

### æ‰§è¡Œæ­¥éª¤
1. **é‡å¯åç«¯** - `python backend_server.py`
2. **æ¸…ç©ºæµè§ˆå™¨ç¼“å­˜** - Ctrl+Shift+Delete
3. **ç¡¬åˆ·æ–°** - Ctrl+F5

### æµ‹è¯•åœºæ™¯

#### åœºæ™¯1ï¼šè®¾ç½®å•ä¸ªæ—¶é—´
1. ç™»å½•ç”¨è¯ç®¡ç†
2. é€‰æ‹©æ¡£æ¡ˆä¸­çš„ä¸€ä¸ªç”¨è¯
3. æ·»åŠ æé†’
4. è®¾ç½®æ—¶é—´ä¸º `10:30`
5. ä¿å­˜

**é¢„æœŸç»“æœï¼š**
```json
{
  "times": ["10:30"],  // âœ… åº”è¯¥æ˜¯10:30
  "reminder_type": "daily"
}
```

#### åœºæ™¯2ï¼šè®¾ç½®å¤šä¸ªæ—¶é—´
1. æ·»åŠ æé†’
2. è®¾ç½®ç¬¬ä¸€ä¸ªæ—¶é—´ä¸º `08:00`
3. ç‚¹å‡»"â• æ·»åŠ æ›´å¤šæ—¶é—´"
4. è®¾ç½®ç¬¬äºŒä¸ªæ—¶é—´ä¸º `14:00`
5. å†æ¬¡ç‚¹å‡»"â• æ·»åŠ æ›´å¤šæ—¶é—´"
6. è®¾ç½®ç¬¬ä¸‰ä¸ªæ—¶é—´ä¸º `20:00`
7. ä¿å­˜

**é¢„æœŸç»“æœï¼š**
```json
{
  "times": ["08:00", "14:00", "20:00"],  // âœ… å…¨éƒ¨åº”è¯¥è¢«ä¿å­˜
  "reminder_type": "daily"
}
```

#### åœºæ™¯3ï¼šåˆ‡æ¢æé†’ç±»å‹
1. æ·»åŠ æé†’
2. è®¾ç½®æ—¶é—´ä¸º `09:00`
3. é€‰æ‹©"é—´éš”å¤©æ•°æé†’"
4. è®¾ç½®é—´éš”ä¸º `2`
5. ä¿å­˜

**é¢„æœŸç»“æœï¼š**
```json
{
  "times": ["09:00"],
  "reminder_type": "interval",  // âœ… åº”è¯¥æ˜¯interval
  "interval_days": 2
}
```

#### åœºæ™¯4ï¼šè‡ªå®šä¹‰æ˜ŸæœŸ
1. æ·»åŠ æé†’
2. é€‰æ‹©"è‡ªå®šä¹‰æ˜ŸæœŸ"
3. é€‰æ‹©å‘¨ä¸€ã€ä¸‰ã€äº”
4. è®¾ç½®æ—¶é—´ä¸º `10:00`
5. ä¿å­˜

**é¢„æœŸç»“æœï¼š**
```json
{
  "times": ["10:00"],
  "reminder_type": "custom",  // âœ… åº”è¯¥æ˜¯custom
  "custom_schedule": ["å‘¨ä¸€", "å‘¨ä¸‰", "å‘¨äº”"]
}
```

### éªŒè¯æ£€æŸ¥åˆ—è¡¨

- [ ] è®¾ç½®æ—¶é—´ä¸å†é»˜è®¤ä¸º08:00
- [ ] å¤šä¸ªæ—¶é—´éƒ½èƒ½è¢«ä¿å­˜
- [ ] æé†’ç±»å‹ï¼ˆdaily/interval/customï¼‰èƒ½è¢«æ­£ç¡®ä¿å­˜
- [ ] è‡ªå®šä¹‰æ—¥æœŸèƒ½è¢«ä¿å­˜
- [ ] æ‰“å¼€æ–°æé†’è¡¨å•æ—¶ï¼Œæ—§çš„æ—¶é—´è¾“å…¥æ¡†è¢«æ¸…é™¤
- [ ] æ·»åŠ å¤šä¸ªæ—¶é—´åèƒ½æ­£ç¡®åˆ é™¤

## ğŸ“Š æ•°æ®ç»“æ„å˜æ›´

### æ—§æ•°æ®æ ¼å¼
```json
{
  "id": "xxx",
  "medication_id": "yyy",
  "time": "08:00",
  "days": ["æ¯å¤©"],
  "enabled": true
}
```

### æ–°æ•°æ®æ ¼å¼
```json
{
  "id": "xxx",
  "medication_id": "yyy",
  "times": ["08:00", "14:00", "20:00"],
  "reminder_type": "daily",
  "interval_days": null,
  "custom_schedule": null,
  "enabled": true
}
```

## ğŸ”„ å‘åå…¼å®¹æ€§

åç«¯ä»£ç èƒ½å¤Ÿå¤„ç†æ—§æ•°æ®ï¼š
```python
times = reminder_data.get('times')
if not times:
    # å…¼å®¹æ—§æ ¼å¼ï¼šä»timeè·å–
    time_val = reminder_data.get('time', '08:00')
    times = [time_val] if time_val else ['08:00']
```

å› æ­¤æ—§çš„æé†’æ•°æ®ä»ç„¶èƒ½æ­£å¸¸å·¥ä½œã€‚

## ğŸ’¾ æ•°æ®æ¸…ç†

å·²æ¸…ç©ºçš„æ–‡ä»¶ï¼š
```
âœ… data/medication_reminders.json
```

## ğŸš€ ç«‹å³é‡‡å–è¡ŒåŠ¨

1. **é‡å¯åç«¯** 
   ```bash
   python backend_server.py
   ```

2. **æ¸…ç©ºç¼“å­˜**
   - Ctrl + Shift + Delete
   - é€‰æ‹©"æ‰€æœ‰æ—¶é—´"
   - å‹¾é€‰"Cookie å’Œå…¶ä»–ç½‘ç«™æ•°æ®"

3. **ç¡¬åˆ·æ–°é¡µé¢**
   - Ctrl + F5

4. **æµ‹è¯•æ–°æé†’åŠŸèƒ½**
   - è®¾ç½®å¤šä¸ªæ—¶é—´
   - éªŒè¯ä¿å­˜çš„æ—¶é—´æ˜¯å¦æ­£ç¡®

## âœ¨ ä¿®å¤æ•ˆæœ

### ä¿®å¤å‰
âŒ è®¾ç½®æ—¶é—´ä¸º10:30 â†’ ä¿å­˜åå˜æˆ08:00  
âŒ è®¾ç½®å¤šä¸ªæ—¶é—´ â†’ åªä¿å­˜ä¸€ä¸ª  
âŒ è¡¨å•æ‰“å¼€æ—¶æœ‰æ®‹ç•™è¾“å…¥æ¡†

### ä¿®å¤å
âœ… è®¾ç½®çš„æ—¶é—´è¢«æ­£ç¡®ä¿å­˜  
âœ… å¤šä¸ªæ—¶é—´éƒ½è¢«ä¿å­˜ä¸ºæ•°ç»„  
âœ… æé†’ç±»å‹å’Œè‡ªå®šä¹‰æ—¥æœŸè¢«ä¿å­˜  
âœ… è¡¨å•æ¸…æ™°ï¼Œæ²¡æœ‰æ®‹ç•™

## ğŸ“ å¦‚ä»æœ‰é—®é¢˜

è¯·æ£€æŸ¥ï¼š
1. æµè§ˆå™¨F12 Networkä¸­ï¼Œå‘é€çš„æé†’æ•°æ®æ˜¯å¦åŒ…å« `times` æ•°ç»„
2. åç«¯å“åº”æ•°æ®ä¸­çš„ `times` å­—æ®µå€¼
3. æ•°æ®åº“ä¸­ä¿å­˜çš„ `times` å­—æ®µå†…å®¹

æˆ–è€…æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°çš„é”™è¯¯ä¿¡æ¯ã€‚
