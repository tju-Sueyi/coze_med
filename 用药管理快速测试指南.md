# 用药管理快速测试指南

## 🚀 快速开始

### 1. 刷新页面
```
Ctrl + F5 (强制刷新)
```

### 2. 访问
```
http://localhost:5000/medication.html
```

## 📋 测试清单

### ✅ 测试1：档案选择
1. 进入用药管理页面
2. 查看顶部是否显示档案选择下拉框
3. 选择一个健康档案
4. 确认提示"已切换到档案：XXX"

**预期结果：** 能成功选择档案并显示提示

---

### ✅ 测试2：添加用药（档案关联）
1. 选择一个档案
2. 点击"添加用药"按钮
3. 填写药品信息：
   - 名称：阿莫西林胶囊
   - 剂量：500mg
   - 频率：每日3次
   - 疗程：7天
   - 分类：西药
4. 点击保存

**预期结果：** 
- 添加成功
- 用药卡片显示档案信息
- 状态显示"使用中"

---

### ✅ 测试3：增强的提醒功能

#### 测试3.1：一天多次提醒
1. 进入"服药提醒"标签
2. 点击"添加提醒"
3. 选择刚添加的药品
4. 提醒类型：选择"每天提醒"
5. 添加多个时间：
   - 第一个时间：08:00
   - 点击"添加更多时间"
   - 第二个时间：12:00
   - 再次点击"添加更多时间"
   - 第三个时间：18:00
6. 点击保存

**预期结果：** 
- 提醒添加成功
- 提醒卡片显示"08:00, 12:00, 18:00"

#### 测试3.2：间隔天数提醒
1. 添加新提醒
2. 提醒类型：选择"间隔天数提醒"
3. 间隔天数：2
4. 时间：09:00
5. 保存

**预期结果：** 提醒卡片显示"每2天"

#### 测试3.3：自定义星期提醒
1. 添加新提醒
2. 提醒类型：选择"自定义星期"
3. 勾选：周一、周三、周五
4. 时间：10:00
5. 保存

**预期结果：** 提醒卡片显示"周一, 周三, 周五"

---

### ✅ 测试4：浏览器通知

#### 测试4.1：开启通知权限
1. 查看页面顶部是否有橙色横幅
2. 点击"开启通知"按钮
3. 允许浏览器通知权限
4. 观察是否收到测试通知"用药提醒已开启"

**预期结果：** 
- 横幅消失
- 收到测试通知
- 浏览器地址栏显示通知图标

#### 测试4.2：测试实时通知
1. 添加一个提醒，时间设置为当前时间后1分钟
2. 等待1分钟
3. 观察是否收到通知

**预期结果：** 
- 到时间后收到桌面通知
- 显示药品名称
- 可以点击通知

---

### ✅ 测试5：服药记录（档案关联）

#### 测试5.1：快速记录
1. 回到"我的用药"标签
2. 找到一条用药记录
3. 点击"✅ 记录服药"按钮

**预期结果：** 
- 显示"服药已记录"
- 用药统计数据更新

#### 测试5.2：详细记录
1. 进入"服药记录"标签
2. 点击"记录服药"按钮
3. 选择药品
4. 填写详细信息
5. 保存

**预期结果：** 
- 记录保存成功
- 服药记录列表显示新记录
- 显示服药人信息（档案名称）

---

### ✅ 测试6：AI分析（档案隔离）

#### 测试6.1：单档案分析
1. 确保当前档案有至少2个"使用中"的用药
2. 进入"AI分析"标签
3. 点击"开始分析"按钮
4. 等待分析完成

**预期结果：** 
- 显示总体评估
- 可能显示药物相互作用（如果有）
- 显示用药建议
- 只分析当前档案的药物

#### 测试6.2：切换档案测试隔离
1. 记住当前AI分析结果
2. 切换到另一个档案
3. 为新档案添加不同的用药
4. 再次进行AI分析
5. 对比两次分析结果

**预期结果：** 
- 两次分析结果不同
- 各自只分析对应档案的药物

---

### ✅ 测试7：用药统计（档案隔离）

#### 测试7.1：查看统计
1. 进入"用药统计"标签
2. 查看统计数据

**预期结果：** 
- 显示用药种类、应服次数、已服次数
- 显示依从性百分比
- 显示依从性评价

#### 测试7.2：档案切换测试
1. 记录当前统计数据
2. 切换到另一个档案
3. 查看统计数据

**预期结果：** 
- 统计数据不同
- 各自独立计算

---

### ✅ 测试8：档案隔离完整性

1. 创建档案A，添加用药：阿莫西林
2. 创建档案B，添加用药：布洛芬
3. 切换到档案A，查看用药列表
4. 切换到档案B，查看用药列表
5. 分别记录服药
6. 分别查看统计

**预期结果：** 
- 档案A只显示阿莫西林
- 档案B只显示布洛芬
- 服药记录完全隔离
- 统计数据完全独立

---

## 🎯 重点测试项

### 高优先级
- ✅ 档案选择和切换
- ✅ 一天多次提醒设置
- ✅ 浏览器通知接收
- ✅ AI分析功能
- ✅ 档案数据隔离

### 中优先级
- ✅ 间隔天数提醒
- ✅ 自定义星期提醒
- ✅ 服药记录档案信息
- ✅ 统计数据准确性

### 低优先级
- ✅ UI显示正确性
- ✅ 提示信息友好性
- ✅ 操作流畅性

---

## 🐛 问题反馈

### 如果遇到问题

1. **打开浏览器控制台**
   ```
   按 F12 → Console 标签
   ```

2. **查看错误信息**
   - 红色错误提示
   - 网络请求失败

3. **检查后端日志**
   ```
   查看 backend.log 文件
   ```

4. **常见问题**

   **问题1：档案选择器是空的**
   - 原因：没有创建健康档案
   - 解决：先在主页创建健康档案

   **问题2：通知不弹出**
   - 原因：权限未授予或浏览器不支持
   - 解决：检查浏览器权限设置

   **问题3：AI分析失败**
   - 原因：没有活跃用药或API问题
   - 解决：确保有"使用中"的用药，检查后端API配置

   **问题4：数据没有隔离**
   - 原因：档案ID未正确保存
   - 解决：检查控制台错误，确认backend_server.py已更新

---

## ✅ 测试完成清单

完成以下所有测试后，功能验证完成：

- [ ] 档案选择正常
- [ ] 添加用药成功（含档案关联）
- [ ] 一天多次提醒设置成功
- [ ] 间隔天数提醒设置成功
- [ ] 自定义星期提醒设置成功
- [ ] 浏览器通知权限开启
- [ ] 收到测试通知
- [ ] 快速记录服药成功
- [ ] 详细记录服药成功（含档案信息）
- [ ] AI分析功能正常
- [ ] AI分析支持档案隔离
- [ ] 用药统计数据正确
- [ ] 统计支持档案隔离
- [ ] 档案切换后数据完全隔离

---

## 🎉 测试通过标准

全部功能测试通过后，应该能够：

1. ✅ 为不同档案管理独立的用药
2. ✅ 设置灵活的服药提醒（多种类型、多个时间）
3. ✅ 接收浏览器桌面通知
4. ✅ 快速或详细记录服药
5. ✅ 获得AI智能分析
6. ✅ 查看准确的统计数据
7. ✅ 所有数据按档案完全隔离

---

**测试日期：** _______  
**测试人：** _______  
**测试结果：** ☐ 通过 ☐ 未通过  
**备注：** _______________________

