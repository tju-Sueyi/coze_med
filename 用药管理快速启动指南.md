# 用药管理功能 - 快速启动指南

## 🚀 快速开始

### 1. 启动后端服务

使用现有的批处理文件启动：

```bash
# Windows
start.bat
```

或者直接运行：

```bash
python backend_server.py
```

服务将在 `http://localhost:5000` 启动

### 2. 访问用药管理页面

在浏览器中打开以下任一方式：

**方式一：通过主页**
1. 访问 `http://localhost:5000`
2. 登录你的账户
3. 在首页功能卡片中点击"个性化用药管理"

**方式二：直接访问**
1. 访问 `http://localhost:5000/medication.html`
2. 系统会自动检查登录状态

### 3. 开始使用

#### 添加第一条用药记录
1. 进入"我的用药"标签
2. 点击"➕ 添加用药"按钮
3. 填写药品信息：
   - 药品名称（必填）
   - 剂量（如：100mg）
   - 服用频率（如：每日3次）
   - 疗程（如：7天）
   - 其他信息
4. 点击"保存"

#### 设置服药提醒
1. 进入"服药提醒"标签
2. 点击"➕ 添加提醒"按钮
3. 选择药品
4. 设置提醒时间（如：08:00）
5. 选择提醒频率
6. 点击"保存"

#### 记录服药
**快速记录：**
- 在"我的用药"列表中，点击药品旁的"✅ 记录服药"按钮

**详细记录：**
1. 进入"服药记录"标签
2. 点击"✅ 记录服药"按钮
3. 填写详细信息
4. 点击"保存"

#### AI分析用药
1. 确保已添加至少一条"使用中"的用药记录
2. 进入"AI分析"标签
3. 点击"🤖 开始分析"按钮
4. 等待几秒
5. 查看分析结果：
   - 总体评估
   - 药物相互作用
   - 安全警告
   - 用药建议

#### 查看统计
1. 进入"用药统计"标签
2. 查看：
   - 用药种类数
   - 应服次数
   - 已服次数
   - 依从性百分比

## 🧪 功能测试

运行测试脚本验证功能：

```bash
python test_medication_management.py
```

测试脚本会自动：
1. 添加测试用药记录
2. 获取用药列表
3. 添加服药提醒
4. 记录服药
5. 查看统计数据
6. 执行AI分析

## 📁 文件说明

### 新增文件

1. **后端模块**
   - `medication_management.py` - 核心功能模块

2. **前端文件**
   - `medication.html` - 用药管理页面
   - `medication.js` - 交互逻辑

3. **数据文件**（自动创建）
   - `data/medications.json` - 用药记录
   - `data/medication_reminders.json` - 服药提醒
   - `data/medication_intake_records.json` - 服药历史

4. **测试和文档**
   - `test_medication_management.py` - 测试脚本
   - `个性化用药管理功能说明.md` - 详细文档
   - `用药管理快速启动指南.md` - 本文件

### 修改文件

1. **backend_server.py**
   - 新增用药管理相关API接口（约300行代码）
   - 位置：文件末尾，`if __name__ == '__main__':` 之前

2. **index.html**
   - 在首页功能区添加"个性化用药管理"入口卡片
   - 位置：功能卡片网格区域

## 📊 API接口说明

### 基础URL
```
http://localhost:5000/api
```

### 接口列表

#### 1. 用药记录
```
GET    /medications                    # 获取用药列表
POST   /medications                    # 添加用药
PUT    /medications/<id>               # 更新用药
DELETE /medications/<id>               # 删除用药
```

#### 2. 服药提醒
```
GET    /medications/reminders          # 获取提醒列表
POST   /medications/reminders          # 添加提醒
PUT    /medications/reminders/<id>     # 更新提醒
DELETE /medications/reminders/<id>     # 删除提醒
```

#### 3. 服药记录
```
GET    /medications/intake-records     # 获取服药记录
POST   /medications/intake-records     # 记录服药
```

#### 4. 统计分析
```
GET    /medications/adherence-stats    # 获取依从性统计
POST   /medications/ai-analyze         # AI分析用药
```

### 请求示例

**添加用药记录**
```bash
curl -X POST http://localhost:5000/api/medications \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser",
    "medication": {
      "name": "阿莫西林",
      "dosage": "500mg",
      "frequency": "每日3次",
      "duration": "7天",
      "category": "西药"
    }
  }'
```

**获取用药列表**
```bash
curl http://localhost:5000/api/medications?username=testuser
```

**AI分析**
```bash
curl -X POST http://localhost:5000/api/medications/ai-analyze \
  -H "Content-Type: application/json" \
  -d '{
    "username": "testuser"
  }'
```

## 🔧 常见问题

### Q1: 页面显示"请先登录"
**解决方案：**
1. 先访问主页 `http://localhost:5000`
2. 登录你的账户
3. 再访问用药管理页面

### Q2: AI分析显示"当前没有活跃的用药记录"
**解决方案：**
1. 确保已添加用药记录
2. 确保用药状态为"使用中"（active）
3. 不要把所有药物都标记为"已完成"或"已停用"

### Q3: 提醒功能无法使用
**说明：**
- 当前版本的提醒是记录在系统中
- 浏览器通知功能需要额外开发
- 建议配合手机闹钟使用

### Q4: 无法连接到服务器
**解决方案：**
1. 确认后端服务已启动
2. 检查端口5000是否被占用
3. 查看 `backend.log` 日志文件

### Q5: 数据丢失
**说明：**
- 数据保存在 `data/` 目录下的JSON文件中
- 建议定期备份这些文件
- 不要手动编辑JSON文件，可能导致格式错误

## 💡 使用技巧

### 1. 批量添加用药
如果有多个药物需要添加，建议：
- 准备好所有药品信息
- 逐一添加并设置提醒
- 统一记录开始日期

### 2. 提高依从性
- 每个药物设置多个提醒时间
- 每次服药后立即记录
- 每周查看一次统计数据
- 根据AI分析调整用药习惯

### 3. AI分析建议
- 添加完整的用药信息（剂量、频率）
- 定期（如每周）进行一次AI分析
- 重点关注"高"严重程度的相互作用
- 有疑问时咨询医生

### 4. 数据管理
- 疗程结束后及时标记为"已完成"
- 不再使用的药物标记为"已停用"
- 保持活跃用药列表清晰
- 备注栏记录重要信息（如副作用）

## 📱 功能特色

### ✨ 亮点功能

1. **智能AI分析**
   - 基于通义千问大模型
   - 自动检测药物相互作用
   - 提供专业用药建议

2. **可视化统计**
   - 直观的数据展示
   - 依从性评分
   - 颜色编码提示

3. **快速操作**
   - 一键记录服药
   - 快捷状态更新
   - 灵活的提醒管理

4. **用户友好**
   - 响应式设计
   - 清晰的界面
   - 简单的操作流程

## 🔐 安全提示

⚠️ **重要提醒：**

1. **本功能仅供参考**
   - 不能替代专业医疗建议
   - 不应作为诊断或治疗依据

2. **遵医嘱用药**
   - 所有用药应遵循医生指导
   - 不要自行调整药物剂量
   - 不要随意停药或换药

3. **AI分析结果**
   - 仅供参考
   - 重要决策请咨询医生
   - 不保证100%准确

4. **紧急情况**
   - 出现严重不良反应立即停药
   - 及时就医
   - 不要仅依赖本系统

## 📞 技术支持

如遇到问题：
1. 查看 `backend.log` 日志文件
2. 查看浏览器控制台（F12）
3. 阅读 `个性化用药管理功能说明.md`
4. 联系开发团队

## 🎉 开始使用

现在你可以：
1. ✅ 启动后端服务
2. ✅ 访问用药管理页面
3. ✅ 添加你的第一条用药记录
4. ✅ 体验AI智能分析

祝你用药管理更轻松！💊✨

---

**版本：** v1.0  
**更新日期：** 2025-10-28

