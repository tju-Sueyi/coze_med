# 医疗AI小助手 - 移动端网页应用

这是一个基于原生HTML、CSS、JavaScript开发的医疗AI助手移动端网页应用，复现了原始App的主要功能。

## 功能特性

### 智能分诊助手
- 根据症状智能推荐就诊科室
- 支持手动输入自定义症状
- 提供科室详细信息和就诊建议

### 医院搜索功能（新增）
- 集成百度地图API，提供真实的医院搜索服务
- 自动获取用户地理位置，搜索附近医院
- 显示医院详细信息，包括地址、电话等
- 提供地图导航、电话拨打、一键导航等实用功能

## 百度地图API配置

医院搜索功能需要百度地图API密钥才能正常工作。请按照以下步骤获取和配置API密钥：

### 申请百度地图API密钥

1. 访问百度地图开放平台：[https://lbs.baidu.com/](https://lbs.baidu.com/)
2. 点击"控制台" -> "应用管理" -> "我的应用"
3. 点击"创建应用"按钮
4. 选择"浏览器端"应用类型
5. 填写应用信息：
   - 应用名称：智慧医疗AI平台
   - 应用类型：浏览器端
   - Referer白名单：`*`（或您的域名）
6. 提交申请后，系统会生成API密钥（AK）

### 配置API密钥

在 `index.html` 文件中找到以下行：
```html
<script type="text/javascript" src="https://api.map.baidu.com/api?v=3.0&ak=您的百度地图API密钥"></script>
```

将 `您的百度地图API密钥` 替换为您申请的实际API密钥。

### 注意事项

- API密钥是免费的，但有一定的调用配额限制
- 为了更好的用户体验，建议申请正式的密钥而非测试密钥
- 如果暂时没有API密钥，医院搜索功能将显示备用方案，提供搜索建议

### 百度地图API白名单配置（特别针对本地开发）

#### 本地开发环境配置

当您的网站运行在本地服务器上时（`http://localhost:8000/`），需要特别配置白名单：

**推荐配置（最简单）**：
```
*
```
通配符 `*` 允许所有域名访问，包括本地开发环境。

**详细配置选项**：
```
localhost
127.0.0.1
localhost:8000
127.0.0.1:8000
```

#### 配置步骤

1. **登录百度地图控制台**：https://lbs.baidu.com/apiconsole/key
2. **选择您的应用**，点击"编辑"
3. **找到"Referer白名单"设置**
4. **添加以下任一配置**：

**方案一（推荐）**：
- 输入 `*` 并保存

**方案二（精确匹配）**：
- 输入 `localhost`
- 输入 `127.0.0.1`
- 输入 `localhost:8000`
- 输入 `127.0.0.1:8000`

#### 验证配置是否生效

1. **查看实时状态指示器**
   - 刷新网站 `http://localhost:8000/`
   - 查看页面右上角的百度地图API状态指示器
   - 正常情况下应显示绿色"✅ 百度地图API正常"

2. **使用专用测试页面**
   - 访问 `http://localhost:8000/test_map.html`
   - 点击"运行全部测试"按钮
   - 查看每个测试步骤的结果

3. **浏览器控制台调试**
   - 按F12打开开发者工具
   - 在Console中输入以下命令：

   ```javascript
   // 检查API状态
   debugMapAPI()

   // 强制重新加载API
   forceReloadBaiduMap()

   // 查看当前域名和端口
   console.log('域名:', window.location.hostname);
   console.log('端口:', window.location.port);
   ```

#### 如果仍然有问题

1. **清除浏览器缓存**并刷新页面
2. **检查Network标签页**，确认API请求成功（状态码200）
3. **确认API密钥有足够配额**
4. **使用测试页面诊断问题**：
   - 访问 `http://localhost:8000/test_map.html` 运行完整的API测试
   - 查看测试结果确定具体问题环节

### 故障排除

如果医院搜索功能显示"地图服务暂时不可用"，请按以下步骤排查：

1. **检查API密钥配置**
   - 确认已正确替换 `index.html` 中的API密钥
   - 确保API密钥未过期且有足够配额

2. **检查Referer白名单设置**
   - 按照上述指南正确配置白名单
   - 建议先使用 `*` 通配符测试

3. **检查浏览器控制台错误**
   - 按F12打开开发者工具
   - 查看Console标签页是否有错误信息
   - 检查Network标签页是否成功加载百度地图API

4. **网络连接测试**
   - 确认能够访问 `https://api.map.baidu.com`
   - 检查防火墙或代理设置是否阻止API调用

5. **重试机制**
   - 点击备用方案中的"重试地图服务"按钮
   - 或刷新页面重新加载地图API

6. **备用方案**
   - 如果地图服务持续不可用，系统会显示备用搜索建议
   - 可以通过"百度地图中搜索"按钮直接跳转到百度地图网页版

### 🏥 主要功能模块

1. **用户角色选择**
   - 患者入口
   - 医生入口（开发中）
   - 家属入口

2. **患者功能**
   - 症状分析与智能分诊
   - AI诊断助手对话
   - 体检报告管理
   - 病情评估
   - 紧急联系功能

3. **AI智能诊断**
   - 症状输入与分析
   - 疾病风险预测
   - 药物推荐
   - 再入院风险评估
   - 住院时长预测

4. **家属功能**
   - 家庭成员健康管理
   - 代理咨询功能
   - 智能分析工具

5. **用药管理**
   - 用药打卡功能
   - 用药提醒
   - 用药记录存储

6. **常见问题查询**
   - 疾病知识库
   - 症状自查
   - 科室导诊

### 🤖 AI医疗功能 (Qwen-VL-Max驱动)

应用集成了阿里云通义千问大模型，提供专业的医疗AI分析：

- **🩺 症状智能分析**：基于Qwen-VL-Max的专业症状分析和诊疗建议
- **💬 AI健康咨询**：支持多轮对话的智能医疗咨询服务
- **💊 药物推荐系统**：基于症状和病史的个性化用药建议
- **🚨 紧急程度评估**：智能评估症状的紧急程度和就医建议
- **📊 疾病风险预测**：基于患者信息预测疾病风险
- **🏥 住院评估**：再入院风险和住院时长预测

**AI技术栈：**
- **模型**：Qwen-VL-Max (通义千问视觉语言大模型)
- **API**：阿里云百炼平台 DashScope API
- **架构**：Python Flask + OpenAI兼容接口
- **实时性**：支持流式对话和实时分析

## 技术架构

### 🏗️ 前端技术栈

- **HTML5**：语义化标记，移动端适配
- **CSS3**：
  - 响应式设计
  - 渐变背景
  - 动画效果
  - 移动端优化
- **JavaScript ES6+**：
  - 模块化开发
  - 异步处理
  - 事件管理
  - 本地存储

### 📱 移动端特性

- **响应式设计**：适配各种移动设备屏幕
- **触摸优化**：优化的点击体验
- **状态栏模拟**：仿真iOS状态栏
- **底部导航**：固定底部导航栏
- **页面转场**：流畅的页面切换动画

## 文件结构

```
coze本地化/
├── index.html          # 主页面文件 (前端入口)
├── styles.css          # 样式文件 (UI设计)
├── script.js           # 主要交互逻辑 (前端)
├── ai-medical.js       # AI医疗功能模块 (前端)
├── backend_server.py   # 后端AI服务 (Flask + Qwen API)
├── requirements.txt    # Python依赖项
├── start_app.py        # 应用启动脚本
├── 启动应用.bat       # Windows启动脚本
├── README.md          # 说明文档
└── coze基础/           # 原始设计截图
    ├── 微信图片_*.png  # UI参考截图
    └── ...
```

## 快速开始

### 📦 安装使用

#### 🚀 快速启动 (推荐)

1. **下载项目到本地**

2. **一键启动**
   ```bash
   # Windows用户 - 双击运行
   启动应用.bat
   
   # 或者使用Python启动脚本
   python start_app.py
   ```

3. **自动打开浏览器**
   - 应用会自动在浏览器中打开
   - 前端地址：`http://localhost:8000`
   - 后端API：`http://localhost:5000`

#### 🛠️ 手动启动

1. **安装依赖**
   ```bash
   pip install flask flask-cors openai
   ```

2. **启动后端服务**
   ```bash
   python backend_server.py
   ```

3. **启动前端服务**
   ```bash
   # 新开终端窗口
   python -m http.server 8000
   ```

4. **访问应用**
   - 访问 `http://localhost:8000`

### 🔑 AI配置说明

**Qwen API已预配置**
- API Key：`sk-8e5ea74e20a54f88a4f1d2d0d82cd71c`
- 模型：`qwen-vl-max`
- 服务地址：`https://dashscope.aliyuncs.com/compatible-mode/v1`

**功能特点**
- ✅ 专业的医疗知识问答
- ✅ 症状分析和诊疗建议
- ✅ 多轮对话记忆功能
- ✅ 紧急程度智能评估
- ✅ 个性化用药建议
- ✅ 实时AI分析响应

**API调用示例**
```bash
# 健康咨询
curl -X POST "http://localhost:5000/api/health-consultation" \
  -H "Content-Type: application/json" \
  -d '{"question": "我头痛怎么办？"}'

# 症状分析  
curl -X POST "http://localhost:5000/api/analyze-symptoms" \
  -H "Content-Type: application/json" \
  -d '{"symptoms": "头痛、发热", "patient_info": {"age": 30}}'
```

### 📱 移动端测试

**Chrome开发者工具**
1. 按 F12 打开开发者工具
2. 点击设备模拟图标（手机/平板图标）
3. 选择移动设备型号（推荐iPhone 12 Pro）
4. 刷新页面查看移动端效果

**真机测试**
1. 确保手机和电脑在同一网络
2. 获取电脑IP地址
3. 在手机浏览器访问 `http://[电脑IP]:8000`

## 使用指南

### 🚀 基本操作

1. **选择角色**
   - 首页点击对应角色按钮进入相应功能

2. **症状分析**
   - 在症状分析页面输入症状
   - 点击预设症状标签快速选择
   - 查看AI分析结果和建议

3. **AI对话**
   - 在诊断助手页面输入问题
   - 发送消息获得AI智能回复
   - 支持症状描述、用药咨询等

4. **用药打卡**
   - 输入用药信息
   - 点击打卡按钮记录
   - 查看用药历史记录

### 🤖 AI功能使用

**症状分析示例**：
- 输入："头痛三天了，还有点发热"
- AI会分析症状严重程度、提供诊疗建议
- 评估风险等级并给出就医建议

**药物咨询示例**：
- 输入："感冒了吃什么药好？"
- AI会推荐合适的药物和用法
- 提供用药注意事项

## 功能详解

### 🔍 症状分析功能

- **智能识别**：自动识别输入的症状关键词
- **风险评估**：评估症状的紧急程度
- **分诊建议**：提供科室就医建议
- **用药指导**：推荐对症药物

### 💬 AI对话功能

- **自然语言处理**：理解用户的症状描述
- **上下文记忆**：保持对话连贯性
- **多轮对话**：支持深入的症状询问
- **专业建议**：提供医疗专业建议

### 💊 用药管理功能

- **用药记录**：记录每次用药时间和剂量
- **本地存储**：数据保存在浏览器本地
- **提醒功能**：用药时间提醒（规划中）
- **统计分析**：用药依从性分析（规划中）

## 数据安全

### 🔒 隐私保护

- **本地处理**：所有数据在浏览器本地处理
- **无服务器存储**：不上传个人健康信息到服务器
- **临时缓存**：会话数据仅在当前浏览器会话中保存
- **用户控制**：用户可随时清除本地数据

### 📊 数据存储

- **localStorage**：用药记录等持久化数据
- **sessionStorage**：临时会话数据
- **内存缓存**：对话历史等临时数据

## 浏览器兼容性

### ✅ 支持的浏览器

- **移动端**：
  - iOS Safari 12+
  - Android Chrome 70+
  - 微信内置浏览器
  - 支付宝内置浏览器

- **桌面端**：
  - Chrome 70+
  - Firefox 65+
  - Safari 12+
  - Edge 79+

### ⚠️ 功能限制

- **离线使用**：需要网络连接进行AI分析
- **数据同步**：不支持跨设备数据同步
- **推送通知**：不支持系统级推送通知

## 开发说明

### 🛠️ 开发环境

- **编辑器**：推荐VS Code
- **调试工具**：Chrome DevTools
- **版本控制**：Git
- **代码格式化**：Prettier

### 📈 性能优化

- **图片优化**：使用SVG图标减少体积
- **代码压缩**：生产环境建议压缩JS/CSS
- **缓存策略**：合理使用浏览器缓存
- **懒加载**：大图片使用懒加载

### 🔧 自定义配置

**修改AI响应逻辑**：
编辑 `ai-medical.js` 文件中的分析函数

**调整界面样式**：
修改 `styles.css` 文件中的对应样式

**添加新功能**：
在 `script.js` 中添加新的事件处理函数

## 免责声明

⚠️ **重要提醒**：

1. **仅供参考**：本应用提供的医疗建议仅供参考，不能替代专业医疗诊断
2. **及时就医**：如有严重症状，请立即就医
3. **药物使用**：用药前请咨询医生或药师
4. **数据准确性**：AI分析结果可能存在误差，请谨慎参考

## 技术支持

如有技术问题或建议，请：

1. 检查浏览器控制台错误信息
2. 确认网络连接正常
3. 尝试清除浏览器缓存
4. 使用最新版本的支持浏览器

---

**版本**：v1.0.0  
**更新时间**：2024年12月  
**开发者**：AI Assistant  
**许可证**：MIT License