# åŒ»ç–—AIå¹³å° - ä¸€é”®éƒ¨ç½²æŒ‡å—

æœ¬æŒ‡å—å°†å¸®åŠ©æ‚¨å¿«é€Ÿå°†åŒ»ç–—AIå¹³å°éƒ¨ç½²åˆ°æ–°çš„ç”µè„‘æˆ–æœåŠ¡å™¨ä¸Šã€‚

## ğŸ“‹ ç›®å½•

- [å‰ç½®è¦æ±‚](#å‰ç½®è¦æ±‚)
- [å¿«é€Ÿéƒ¨ç½²](#å¿«é€Ÿéƒ¨ç½²)
- [è¯¦ç»†é…ç½®](#è¯¦ç»†é…ç½®)
- [æœåŠ¡å™¨éƒ¨ç½²](#æœåŠ¡å™¨éƒ¨ç½²)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

## ğŸ”§ å‰ç½®è¦æ±‚

### å¿…éœ€è½¯ä»¶

1. **Python 3.7æˆ–æ›´é«˜ç‰ˆæœ¬**
   - Windows: https://www.python.org/downloads/
   - Linux: `sudo apt install python3 python3-pip` (Ubuntu/Debian)
   - Mac: `brew install python3` æˆ–è®¿é—® Python å®˜ç½‘

2. **pip åŒ…ç®¡ç†å™¨**ï¼ˆé€šå¸¸éšPythonä¸€èµ·å®‰è£…ï¼‰
   - éªŒè¯: `python --version` æˆ– `python3 --version`
   - éªŒè¯: `pip --version` æˆ– `pip3 --version`

### å¯é€‰ä½†æ¨è

- Gitï¼ˆç”¨äºç‰ˆæœ¬æ§åˆ¶ï¼‰
- ä»£ç ç¼–è¾‘å™¨ï¼ˆVS Code, PyCharmç­‰ï¼‰

## ğŸš€ å¿«é€Ÿéƒ¨ç½²

### Windowsç³»ç»Ÿ

1. **è§£å‹æˆ–å…‹éš†é¡¹ç›®**
   ```bash
   # å¦‚æœæ˜¯Gitä»“åº“
   git clone <repository-url>
   cd cozeæœ¬åœ°åŒ–
   ```

2. **è¿è¡Œä¸€é”®éƒ¨ç½²è„šæœ¬**
   ```bash
   # åŒå‡»è¿è¡Œ deploy.bat
   # æˆ–åœ¨å‘½ä»¤è¡Œè¿è¡Œ
   deploy.bat
   ```

3. **å¯åŠ¨åº”ç”¨**
   ```bash
   # æ–¹å¼1: åŒå‡» start.bat
   # æ–¹å¼2: è¿è¡Œ
   python start_app.py
   ```

4. **è®¿é—®åº”ç”¨**
   - æµè§ˆå™¨ä¼šè‡ªåŠ¨æ‰“å¼€ï¼Œæˆ–æ‰‹åŠ¨è®¿é—®: http://localhost:8000

### Linux/Macç³»ç»Ÿ

1. **è§£å‹æˆ–å…‹éš†é¡¹ç›®**
   ```bash
   git clone <repository-url>
   cd cozeæœ¬åœ°åŒ–
   ```

2. **èµ‹äºˆæ‰§è¡Œæƒé™**
   ```bash
   chmod +x deploy.sh
   chmod +x start.sh  # å¦‚æœå­˜åœ¨
   ```

3. **è¿è¡Œä¸€é”®éƒ¨ç½²è„šæœ¬**
   ```bash
   ./deploy.sh
   ```

4. **å¯åŠ¨åº”ç”¨**
   ```bash
   # æ–¹å¼1: ä½¿ç”¨Pythonå¯åŠ¨è„šæœ¬
   python3 start_app.py
   
   # æ–¹å¼2: åˆ†åˆ«å¯åŠ¨åç«¯å’Œå‰ç«¯
   # ç»ˆç«¯1 - åç«¯
   python3 backend_server.py
   
   # ç»ˆç«¯2 - å‰ç«¯
   python3 -m http.server 8000
   ```

5. **è®¿é—®åº”ç”¨**
   - æ‰“å¼€æµè§ˆå™¨è®¿é—®: http://localhost:8000

## âš™ï¸ è¯¦ç»†é…ç½®

### 1. APIå¯†é’¥é…ç½®

#### Qwen/DashScope APIå¯†é’¥

**æ–¹å¼1: ä¿®æ”¹ä»£ç æ–‡ä»¶**
- ç¼–è¾‘ `backend_server.py` ç¬¬239è¡Œ
- å°†é»˜è®¤çš„APIå¯†é’¥æ›¿æ¢ä¸ºæ‚¨çš„å¯†é’¥

**æ–¹å¼2: ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼ˆæ¨èï¼‰**
```bash
# Windows
set DASHSCOPE_API_KEY=sk-your-api-key-here

# Linux/Mac
export DASHSCOPE_API_KEY=sk-your-api-key-here
```

**æ–¹å¼3: ä½¿ç”¨é…ç½®æ–‡ä»¶**
- å¤åˆ¶ `.env.example` ä¸º `.env`
- å¡«å…¥æ‚¨çš„APIå¯†é’¥
- ä¿®æ”¹ `backend_server.py` ä»¥è¯»å– `.env` æ–‡ä»¶ï¼ˆéœ€è¦å®‰è£…python-dotenvï¼‰

#### ç™¾åº¦åœ°å›¾APIå¯†é’¥

ç¼–è¾‘ `index.html` æ–‡ä»¶ï¼Œæ‰¾åˆ°ä»¥ä¸‹è¡Œï¼š
```html
<script type="text/javascript" src="https://api.map.baidu.com/api?v=3.0&ak=æ‚¨çš„ç™¾åº¦åœ°å›¾APIå¯†é’¥"></script>
```
å°† `æ‚¨çš„ç™¾åº¦åœ°å›¾APIå¯†é’¥` æ›¿æ¢ä¸ºå®é™…çš„å¯†é’¥ã€‚

### 2. ç«¯å£é…ç½®

å¦‚æœé»˜è®¤ç«¯å£5000æˆ–8000è¢«å ç”¨ï¼Œå¯ä»¥ä¿®æ”¹ï¼š

**åç«¯ç«¯å£ä¿®æ”¹:**
- ç¼–è¾‘ `backend_server.py`ï¼Œæ‰¾åˆ° `app.run()` éƒ¨åˆ†
- ä¿®æ”¹ç«¯å£å·ï¼Œä¾‹å¦‚: `app.run(port=5001)`

**å‰ç«¯ç«¯å£ä¿®æ”¹:**
- ä¿®æ”¹ `start.bat` æˆ– `start_app.py` ä¸­çš„ç«¯å£å·
- æˆ–æ‰‹åŠ¨å¯åŠ¨: `python -m http.server 8001`

### 3. æ•°æ®ç›®å½•é…ç½®

é»˜è®¤æ•°æ®å­˜å‚¨åœ¨ `data/` ç›®å½•ä¸‹ã€‚å¦‚æœéœ€è¦ä¿®æ”¹ï¼š

1. åˆ›å»ºæ–°çš„æ•°æ®ç›®å½•
2. ä¿®æ”¹ `backend_server.py` ä¸­çš„ `DATA_DIR` å˜é‡ï¼ˆç¬¬2088è¡Œï¼‰

## ğŸŒ æœåŠ¡å™¨éƒ¨ç½²

### ä½¿ç”¨Nginxåå‘ä»£ç†ï¼ˆæ¨èï¼‰

1. **å®‰è£…Nginx**
   ```bash
   # Ubuntu/Debian
   sudo apt install nginx
   
   # CentOS/RHEL
   sudo yum install nginx
   ```

2. **é…ç½®Nginx**
   åˆ›å»ºé…ç½®æ–‡ä»¶ `/etc/nginx/sites-available/medical-ai`:
   ```nginx
   server {
       listen 80;
       server_name your-domain.com;
       
       # å‰ç«¯é™æ€æ–‡ä»¶
       location / {
           proxy_pass http://localhost:8000;
           proxy_set_header Host $host;
           proxy_set_header X-Real-IP $remote_addr;
       }
       
       # åç«¯API
       location /api/ {
           proxy_pass http://localhost:5000/api/;
           proxy_set_header Host $host;
           proxy_set_header X-Real-IP $remote_addr;
       }
       
       # ä¸Šä¼ æ–‡ä»¶
       location /uploads/ {
           proxy_pass http://localhost:5000/uploads/;
       }
   }
   ```

3. **å¯ç”¨é…ç½®**
   ```bash
   sudo ln -s /etc/nginx/sites-available/medical-ai /etc/nginx/sites-enabled/
   sudo nginx -t  # æµ‹è¯•é…ç½®
   sudo systemctl restart nginx
   ```

### ä½¿ç”¨Gunicornéƒ¨ç½²åç«¯ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰

1. **å®‰è£…Gunicorn**
   ```bash
   pip install gunicorn
   ```

2. **å¯åŠ¨åç«¯æœåŠ¡**
   ```bash
   gunicorn -w 4 -b 0.0.0.0:5000 backend_server:app
   ```

3. **ä½¿ç”¨systemdç®¡ç†æœåŠ¡**
   åˆ›å»º `/etc/systemd/system/medical-ai.service`:
   ```ini
   [Unit]
   Description=åŒ»ç–—AIå¹³å°åç«¯æœåŠ¡
   After=network.target
   
   [Service]
   User=www-data
   WorkingDirectory=/path/to/cozeæœ¬åœ°åŒ–
   ExecStart=/usr/bin/gunicorn -w 4 -b 0.0.0.0:5000 backend_server:app
   Restart=always
   
   [Install]
   WantedBy=multi-user.target
   ```

4. **å¯ç”¨æœåŠ¡**
   ```bash
   sudo systemctl daemon-reload
   sudo systemctl enable medical-ai
   sudo systemctl start medical-ai
   ```

### é…ç½®HTTPSï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰

1. **ä½¿ç”¨Let's Encryptè·å–SSLè¯ä¹¦**
   ```bash
   sudo apt install certbot python3-certbot-nginx
   sudo certbot --nginx -d your-domain.com
   ```

2. **è‡ªåŠ¨ç»­æœŸ**
   certbotä¼šè‡ªåŠ¨é…ç½®è‡ªåŠ¨ç»­æœŸï¼Œä¹Ÿå¯æ‰‹åŠ¨æµ‹è¯•:
   ```bash
   sudo certbot renew --dry-run
   ```

### é˜²ç«å¢™é…ç½®

```bash
# Ubuntu/Debian (UFW)
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
sudo ufw enable

# CentOS/RHEL (firewalld)
sudo firewall-cmd --permanent --add-service=http
sudo firewall-cmd --permanent --add-service=https
sudo firewall-cmd --reload
```

## ğŸ” ç¯å¢ƒæ£€æŸ¥

éƒ¨ç½²å‰æˆ–é‡åˆ°é—®é¢˜æ—¶ï¼Œå¯ä»¥è¿è¡Œç¯å¢ƒæ£€æŸ¥è„šæœ¬ï¼š

```bash
# Windows
python check_environment.py

# Linux/Mac
python3 check_environment.py
```

æ£€æŸ¥è„šæœ¬ä¼šéªŒè¯ï¼š
- âœ… Pythonç‰ˆæœ¬
- âœ… pipå·¥å…·
- âœ… Pythonä¾èµ–åŒ…
- âœ… ç›®å½•ç»“æ„
- âœ… æ•°æ®æ–‡ä»¶
- âœ… ç«¯å£å ç”¨
- âœ… é…ç½®æ–‡ä»¶

## ğŸ“¦ éƒ¨ç½²æ–‡ä»¶æ¸…å•

éƒ¨ç½²æ—¶éœ€è¦åŒ…å«ä»¥ä¸‹æ–‡ä»¶ï¼š

### å¿…éœ€æ–‡ä»¶
- `backend_server.py` - åç«¯æœåŠ¡å™¨
- `index.html` - å‰ç«¯ä¸»é¡µé¢
- `script.js` - å‰ç«¯ä¸»è¦é€»è¾‘
- `ai-medical.js` - AIåŒ»ç–—åŠŸèƒ½
- `medication.js` - ç”¨è¯ç®¡ç†åŠŸèƒ½
- `medication_management.py` - ç”¨è¯ç®¡ç†åç«¯
- `styles.css` - æ ·å¼æ–‡ä»¶
- `requirements.txt` - Pythonä¾èµ–
- `start_app.py` - å¯åŠ¨è„šæœ¬
- `start.bat` / `start.sh` - å¿«æ·å¯åŠ¨è„šæœ¬
- `deploy.bat` / `deploy.sh` - éƒ¨ç½²è„šæœ¬

### å¯é€‰æ–‡ä»¶
- `data/` - æ•°æ®ç›®å½•ï¼ˆé¦–æ¬¡éƒ¨ç½²å¯ä¸ºç©ºï¼Œä¼šè‡ªåŠ¨åˆ›å»ºï¼‰
- `ä¸­åŒ»éƒ¨åˆ†/` - ä¸­åŒ»åŠŸèƒ½æ¨¡å—ï¼ˆå¦‚éœ€è¦ï¼‰
- å…¶ä»–æµ‹è¯•æ–‡ä»¶å’Œæ–‡æ¡£ï¼ˆä¸å½±å“è¿è¡Œï¼‰

### ä¸éœ€è¦çš„æ–‡ä»¶
- `__pycache__/` - Pythonç¼“å­˜ï¼ˆä¼šè‡ªåŠ¨ç”Ÿæˆï¼‰
- `*.log` - æ—¥å¿—æ–‡ä»¶
- `.git/` - Gitå†å²ï¼ˆå¦‚ä¸éœ€è¦ç‰ˆæœ¬æ§åˆ¶ï¼‰

## â“ å¸¸è§é—®é¢˜

### Q1: ç«¯å£è¢«å ç”¨æ€ä¹ˆåŠï¼Ÿ

**Windows:**
```bash
# æŸ¥çœ‹å ç”¨ç«¯å£çš„è¿›ç¨‹
netstat -ano | findstr :5000

# ç»“æŸè¿›ç¨‹ï¼ˆæ›¿æ¢PIDä¸ºå®é™…è¿›ç¨‹IDï¼‰
taskkill /PID <PID> /F
```

**Linux/Mac:**
```bash
# æŸ¥çœ‹å ç”¨ç«¯å£çš„è¿›ç¨‹
lsof -i :5000

# ç»“æŸè¿›ç¨‹ï¼ˆæ›¿æ¢PIDä¸ºå®é™…è¿›ç¨‹IDï¼‰
kill -9 <PID>
```

### Q2: ä¾èµ–åŒ…å®‰è£…å¤±è´¥ï¼Ÿ

```bash
# å‡çº§pip
python -m pip install --upgrade pip

# ä½¿ç”¨å›½å†…é•œåƒæºï¼ˆä¸­å›½ç”¨æˆ·ï¼‰
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
```

### Q3: APIè°ƒç”¨å¤±è´¥ï¼Ÿ

1. æ£€æŸ¥APIå¯†é’¥æ˜¯å¦æ­£ç¡®é…ç½®
2. æ£€æŸ¥ç½‘ç»œè¿æ¥
3. æ£€æŸ¥APIé…é¢æ˜¯å¦å……è¶³
4. æŸ¥çœ‹åç«¯æ—¥å¿—: `backend.log` æˆ–æ§åˆ¶å°è¾“å‡º

### Q4: å‰ç«¯æ— æ³•è®¿é—®åç«¯ï¼Ÿ

1. æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œï¼ˆè®¿é—® http://localhost:5000ï¼‰
2. æ£€æŸ¥CORSé…ç½®
3. æ£€æŸ¥é˜²ç«å¢™è®¾ç½®
4. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯ä¿¡æ¯ï¼ˆF12ï¼‰

### Q5: æ•°æ®æ–‡ä»¶ä¸¢å¤±ï¼Ÿ

æ•°æ®æ–‡ä»¶å­˜å‚¨åœ¨ `data/` ç›®å½•ä¸‹ã€‚å¦‚æœä¸¢å¤±ï¼š
- é¦–æ¬¡è¿è¡Œä¼šè‡ªåŠ¨åˆ›å»ºåŸºç¡€æ–‡ä»¶
- å®šæœŸå¤‡ä»½ `data/` ç›®å½•
- å»ºè®®é…ç½®è‡ªåŠ¨å¤‡ä»½è„šæœ¬

### Q6: éƒ¨ç½²åˆ°æœåŠ¡å™¨åæ— æ³•è®¿é—®ï¼Ÿ

1. æ£€æŸ¥æœåŠ¡å™¨é˜²ç«å¢™è§„åˆ™
2. æ£€æŸ¥Nginx/Apacheé…ç½®
3. æ£€æŸ¥æœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ: `systemctl status medical-ai`
4. æ£€æŸ¥æ—¥å¿—: `journalctl -u medical-ai`

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š
1. è¿è¡Œç¯å¢ƒæ£€æŸ¥è„šæœ¬æŸ¥çœ‹é—®é¢˜
2. æ£€æŸ¥æ—¥å¿—æ–‡ä»¶: `backend.log`
3. æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°é”™è¯¯ï¼ˆF12ï¼‰
4. ç¡®è®¤æ‰€æœ‰å‰ç½®è¦æ±‚å·²æ»¡è¶³

## ğŸ”„ æ›´æ–°éƒ¨ç½²

æ›´æ–°ä»£ç åï¼š
```bash
# 1. æ‹‰å–æœ€æ–°ä»£ç 
git pull

# 2. æ›´æ–°ä¾èµ–
pip install -r requirements.txt --upgrade

# 3. é‡å¯æœåŠ¡
# Windows: è¿è¡Œ restart.bat
# Linux: systemctl restart medical-ai
```

---

**ç‰ˆæœ¬**: v1.0.0  
**æ›´æ–°æ—¥æœŸ**: 2024å¹´12æœˆ  
**ç»´æŠ¤è€…**: AI Assistant

